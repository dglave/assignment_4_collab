---
title: "lobster_abundance_stats"
author: "Gabriel De La Rosa, Dylan Glave"
date: "11/12/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(include = FALSE,echo = FALSE, warning = FALSE)
```



```{r}
### Reading in Packages

library(tidyverse)
library(janitor)
library(effsize)
library(here)
library(kableExtra)
library(ggridges)
```


```{r}
### Reading in Data

lobster_abundance <- read_csv("lobster_abundance_sbc_lter.csv", na = "-99999") %>%
  clean_names() 
```


```{r}
### Expanding longer with "uncount()" function. Row with "45" lobsters, will now be 45 observations. Removed "count" row and gives each counted lobster its own rown

lobster_tidy <- lobster_abundance %>% 
  tidyr::uncount(count)
```


```{r}
#### Each lobster now has its own row. 1 variable per column, 1 observation per row AND 1 measurement per cell. 

#### Adding a new column to show the year and month name of each lobster observation: 


#### Parsed date_new column to get month and year separated. 

lobster_parse_date <- lobster_tidy %>% 
  mutate(obs_month = lubridate::month(date, label = TRUE),
         obs_year = lubridate::year(date))

view(lobster_parse_date)
```

```{r}
# Yearly counts by site

lob_year <- lobster_abundance %>% 
  group_by(year, site) %>%
  count(year)

#  Graph these data...

#site_graph <-
ggplot(data = lob_year, aes(x = year, y = n)) +
  geom_col() +
  facet_wrap("site") +
  scale_y_continuous(expand = c(0,0), limits = c(0, 550)) +
  theme_bw() +
  labs(title = "Yearly lobster counts per site", x = "Lobsters counted", y = "Year")

site_graph
```


```{r}
# Results B:

# Pare down data to year, size, site for 2012 and 2018

size_dist <- lobster_parse_date %>% 
  filter(year == c("2018", "2012")) %>%
  select(year, size_mm, site) 

# Divide data frame by year
  
size_2012 <- size_dist %>% 
  filter(year == "2012")

size_2018 <- size_dist %>% 
  filter(year == "2018")

# Compare size distributions across sites...
# For 2012
size_dist_2012 <- ggplot(data = size_2012, aes(x = size_mm)) +
  geom_histogram() +
  facet_wrap(c("site"))

size_dist_2012

# For 2018

size_dist_2018 <- ggplot(data = size_2018, aes(x = size_mm)) +
  geom_histogram() +
  facet_wrap(c("site"))

size_dist_2018

# Ridgeline plot...

# Change year to discrete...
year_compare <- size_dist %>% 
  mutate(year = as.factor(year))

year_compare_graph <- 
  ggplot(data = year_compare, aes(x = size_mm, 
                                  fill = year)) +
  geom_density(alpha = 0.6) +
  facet_wrap("site") +
  theme_bw()

year_compare_graph
  

```




## Introduction





## Data and Methods

Data for this report were collected and provided by the [Santa Barbara Coastal Long Term Environmental Research](https://portal.edirepository.org/nis/metadataviewer?packageid=knb-lter-sbc.77.3) site. 
  Lobster surveys were conducted at five different sites along the mainland side of the Santa Barbara Channel: Naples, Isla Vista, Arroyo Quemado, Mowhawk, and Carpenteria. Naples and Isla Vista are contained within a Marine Protected Area; Arroyo Quemado, Mohawk, and Carpenteria are not. Divers performed four 60m x 5m transects at each site, sampling every two to four weeks through the lobster fishing season (October to March). 

Size is a visual estimate of carapace length in mm. 


## Results

1. 

```{r, include= TRUE}
site_graph
```


2. 


```{r ,include = TRUE}
size_dist_2012

size_dist_2018
```





Part C 

Created MPA, non MPA df
```{r}
# Make MPA and non MPA dataframes

lobster_mpa_2012 <- lobster_parse_date %>% 
  mutate(mpa =
    site %in% c( "IVEE", "NAPL")) %>% 
  filter(mpa == "TRUE") %>% 
  filter(year == 2012)

lobster_mpa_2018 <- lobster_parse_date %>% 
  mutate(mpa =
    site %in% c( "IVEE", "NAPL")) %>% 
  filter(mpa %in% "TRUE") %>% 
  filter(year %in% 2018)

lobster_non_2012 <- lobster_parse_date %>% 
  filter(site %in% c("AQUE", "CARP", "MOHK")) %>% 
  filter(year %in% 2012)

lobster_non_2018 <- lobster_parse_date %>% 
  filter(site %in% c("AQUE", "CARP", "MOHK")) %>% 
  filter(year %in% 2018)


# Let's take a look at these data visually first...


ggplot(data = lobster_mpa_2012, aes(x = size_mm)) +
  geom_histogram()

ggplot(data = lobster_mpa_2018, aes(x = size_mm)) +
  geom_histogram()

ggplot(data = lobster_non_2012, aes(x = size_mm)) +
  geom_histogram()

ggplot(data = lobster_non_2018, aes(x = size_mm)) +
  geom_histogram()

# See if theres a difference in means between MPA and non-MPA sites in 2012

t_2012 <- t.test(lobster_mpa_2012$size_mm, lobster_non_2012$size_mm)

t_2012

# Now look for 2018...

t_2018 <- t.test(lobster_mpa_2018$size_mm, lobster_non_2018$size_mm)

t_2018

# Then for MPA sites...

t_mpa <- t.test(lobster_mpa_2012$size_mm,
                lobster_mpa_2018$size_mm)

t_mpa

# Then for non-mpa sites

t_non <- t.test(lobster_non_2012$size_mm,
                lobster_non_2018$size_mm)

t_non

```

```{r}
ggplot(data = lobster_mpa, aes(x = year, y = size_mm)) +
  geom_col()
```



## Summary 




## References





